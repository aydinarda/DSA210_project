# Sent Mails Analysis & Comparisons with LLM generated mails

## Description

SabancÄ± University DSA210 Introduction to Data Science Course Fall 2024-2025 Term Project.  
This project will be an analysis of my own sent email interactions.

For the final presentation, a file will be shared [here](https://docs.google.com/presentation/d/1wiyq_E6wx1zO6KUc2wcIdjRx3ZfrCVFE2emdkgISrgc/edit?usp=sharing).

In this project, following hypothesis will be tested, characteristics features of emails, that are generated by the ChatGPT will be similar to hand written ones. Their mean in characteristics will be same.

## Table of Contents

- [Motivation](#motivation)  
- [Tools](#tools)
- [Notebooks](#notebooks)  
- [Data Source](#data-source)  
  - [Requested Data](#requested-data)  
  - [ChatGPT API](#chatgpt-api)  
- [Data Processing](#data-processing)  
- [Data Analysis](#data-analysis)  
  - [Subject Analysis](#header-analysis)  
  - [Time Analysis](#time-analysis)  
  - [Mail Body Analysis](#mail-body-analysis)  
  - [GPT-Generated Data Analysis](#gpt-generated-data-analysis)  
- [Findings & Visualizations](#findings-and-visualizations)  
  - [Distributions of Original Data](#distributions-of-original-data)  
  - [Distributions of GPT-Generated Data](#distributions-of-gpt-generated-data)  
  - [Comparative Analysis](#comparative-analysis)  
- [Limitations](#limitations)  
  - [Data Limitations](#data-limitations)  
  - [Privacy Considerations](#privacy-considerations)  
  - [Technical Challenges](#technical-challenges)  
- [Future Work](#future-work)

## Motivation

To kickstart my project for the CS210 course using my own data, I chose to analyze my sent emails to gain insights into their characteristics and compare them to emails generated by an AI model (ChatGPT).  
The motivation is to better understand how AI agents can mimic my email-writing behavior when provided with contextual data.

## Tools

- **Python Notebook:** Used for coding, anaylzing and visualizing.  
- **Pandas:** Used for data cleaning, filtering, and structuring.  
- **Matplotlib and Seaborn:** To have necessary visualizations.  
- **Numpy:** Used for mathematical operations.  
- **Scipy:** Used for statistical analysis.  
- **transformers:** Simplifies the usage of pre-trained models from Hugging Face.
- **openai:** To interact with the OpenAI API.
- **FlagReranker** To compute some [formality score](#formality-score).
- **xlm-roberta-large-xnli** To assigning topics using a [classifier](https://huggingface.co/joeddav/xlm-roberta-large-xnli).

## Notebooks
- **[DSA Analysis](DSA_analysis.ipynb):** To complete initial analysis, parse .mbox, generate the features.
- **[DSA Analysis GPT](DSA_analysis_gpt.ipynb):** Initial analysis, parsing and generating features.
- **[Distributions No Outliers](Distributions_no_outliers.ipynb):** Drop outliers, explore once again.
- **[Visualize Analyze](visualize_analyze.ipynb):** Visualize and analyze the handwritten mails, KS-test, Normal Test, visualizations.
- **[Visualize Analyze GPT](visualize_analyze_gpt.ipynb):** Visualize and analyze the GPT generated mails, KS-test, Normal Test, visualizations.
- **[GPT Interaction](GPT_Interaction.ipynb):** Interactions with the ChatGPT API.
- **[Compare](Compare.ipynb):** Compare GPT generated emails with the handwritten emails.

## Data Source

### Requested Data

Requested data is in `.mbox` format, acquired via Google Takeout. The dataset includes the following:

- **Sent Mails**: Emails I sent, containing:
  - **From:** The sender's email address (two different addresses used).  
  - **To:** The recipient's email address.  
  - **Subject:** The email subject, e.g., "Inquiry about Master's Applications."  
  - **Body:** The main content of the email.  
  - **In-Reply-To:** Indicates **if** the email is a reply to a specific message.  
-A parsed and organized version can be found in [here](example_mail_organized.txt) 

### ChatGPT API

The ChatGPT API is used to generate comparable email data based on the following:  
- Headers synthesized based on context.  
- Emails written for the given situation.  
- Suggested send times, derived from the analysis of original data patterns.  
- GPT 3.5 is used, since it is cheaper per token. 

## Data Processing

Data preprocessing is performed and includes:  
- Cleaning (e.g., removing special characters, handling null values).  
- Structuring (e.g., separating headers, body text, and metadata).  
- Annotating sentiment and tone using NLP techniques.  

## Data Analysis

### Header Analysis
  
  
- Use these as a clue to get more successful points from ChatGPT API

### Time Analysis

- Analyze email-sending patterns by time of day and day of the week.  
- Evaluate GPT-generated timestamps for consistency with original data.  

### Mail Body Analysis

- Study the sentiment, and complexity of email bodies.  
- Measure average word length, sentence structure, and key phrases.
- Using a pretrained model assign topics.

### Formality Score
- Using FlagReranker, mail's similarities to words "formal" and "informal" compared.
- For more information check [here](https://huggingface.co/BAAI/bge-reranker-v2-m3)

### GPT-Generated Data Analysis

- Compare GPT-generated email characteristics (headers, body) with original data to evaluate alignment and deviations.  

## Findings & Visualizations

### Distributions of Original Data

- Visualizations of key characteristics in the original dataset (e.g., word count, time distribution).  
- - Example versions can be viewed [here](initial_distributions.png).
 
  - ## Regarding Time Emails Sent
  - Distributions for almost all the topics support that there is peak on around 8. ![hour_distribution_Complaints_no_outliers](https://github.com/user-attachments/assets/f0949895-d92b-4c13-9536-d93612109251)![hour_distribution_Empty_no_outliers](https://github.com/user-attachments/assets/df79f252-693f-4ccf-8b12-0fd5c1f6d467)![hour_distribution_Other Help_no_outliers](https://github.com/user-attachments/assets/8560bf5c-4cbe-456c-a30a-e14bbcc7492b)
  - Time interval for emails about job applications quite restricted, but data is also limited. ![hour_distribution_Work   Job Applications_no_outliers](https://github.com/user-attachments/assets/e4f57849-1909-4600-af5c-d23d34a95fb3)
  - There is huge difference between weekday and weekend statistcs. ![initial_distributions](https://github.com/user-attachments/assets/7cd19672-c2f8-467a-90f6-94260c36135b)
  ## Physical Characteristics of Mails
    - Means are more similar, aside from 'Empty' emails.
    - Skewness changes comparably. 
    - More data may needed for further analysis.
  ## For more details check the above mentioned [slides](#description).


  
### Distributions of GPT-Generated Data

- Visualizations of the same characteristics in the GPT-generated data.  

### Comparative Analysis

- Overlay comparisons of distributions (e.g., original vs. generated).  
- Hypothesis testing to determine statistical significance of observed differences.  

## Limitations

### Data Limitations

- **Dataset Size:** Limited email data may restrict generalizability.  
- **Subjectivity:** Manual annotations may introduce bias, despite efforts to ensure objectivity.  

### Privacy Considerations

- Email content is anonymized, and only aggregate results and example outputs are shared.  

### Technical Challenges

- **Explainability:** Understanding the rationale behind GPT outputs is complex.  
- **Sentiment Analysis Accuracy:** Dependence on pre-trained models limits nuanced interpretations.  

### RESULTS
- With significance, it is rejected that, GPT generated mails do not have the similar characteristics with the human generated ones, even after lots of details have been provided to ChatGPT.
  
![Spider Web](https://github.com/user-attachments/assets/8d5629d0-2efd-40a1-9f03-4151029057ef)

- All the p-values for the numerical attributes confirmed that when Kolmogorov-Smirnov Test employed.

![KS-Comparison](https://github.com/user-attachments/assets/cca16a3a-e91e-4989-8901-2c2601638744)

## Future Work

- **Sentiment and Context Analysis:** Deepen the analysis of sentiment and email context to refine AI-generated results.  
- **Scaling the Project:** Include emails from multiple individuals to create a broader dataset for analysis.
- **Comparing Versions:** Different versions of ChatGPT (3.5, 4, 4-o) can be compared. 
